var org;!function(t){!function(e){!function(e){!function(e){var i=BABYLON.Color3,s=BABYLON.Vector3,o=BABYLON.StandardMaterial,r=BABYLON.Path2,a=BABYLON.VertexBuffer,n=t.ssatguru.babylonjs.component.EditControl,h=function(){function t(t,e,r,h){var c=this;this.facePicked=0,this.pTemp=s.Zero(),this.v1v=new s(0,0,0),this.v2v=new s(0,0,0),this.v3v=new s(0,0,0),this.camera=e,this.mesh=t,window.addEventListener("keyup",function(t){return c.onKeyUp(t)},!1),this.mesh.markVerticesDataAsUpdatable(a.PositionKind,!0),this.vertices=t.getVerticesData(a.PositionKind),this.faceVertices=t.getIndices(),this.faceSelector=this.createTriangle("selector",1,h),this.faceSelector.material=new o("impactMat",h),this.faceSelector.material.diffuseColor=i.Gray(),this.faceSelector.visibility=.8,this.faceSelector.markVerticesDataAsUpdatable(a.PositionKind,!0),this.faceSelector.renderingGroupId=1,this.ec=new n(this.faceSelector,e,r,.5,!0),this.ec.setLocal(!0),this.ec.enableTranslation(),this.facePicked=90,this.highLightFace(this.facePicked,this.faceSelector),this.highLightFace(this.facePicked,this.faceSelector),this.ec.addActionListener(function(t){c.updateFacePosition(c.facePicked,c.faceSelector),c.mesh.updateVerticesData(a.PositionKind,c.vertices,!1,!1)}),h.onPointerDown=function(t,e){if(2==t.button&&e.hit){if(e.pickedMesh!=c.mesh)return;c.facePicked=e.faceId,console.log("face id "+c.facePicked),c.highLightFace(c.facePicked,c.faceSelector)}}}return t.prototype.updateFacePosition=function(t,e){var i=3*t,o=this.faceVertices[i],r=this.faceVertices[i+1],n=this.faceVertices[i+2],h=this.vertices,c=3*o,p=3*r,m=3*n,f=e.getVerticesData(a.PositionKind),T=e.getWorldMatrix(),l=this.mesh.getWorldMatrix().clone().invert();s.TransformCoordinatesFromFloatsToRef(f[0],f[1],f[2],T,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,l,this.pTemp),h[c]=this.pTemp.x,h[c+1]=this.pTemp.y,h[c+2]=this.pTemp.z,s.TransformCoordinatesFromFloatsToRef(f[3],f[4],f[5],T,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,l,this.pTemp),h[p]=this.pTemp.x,h[p+1]=this.pTemp.y,h[p+2]=this.pTemp.z,s.TransformCoordinatesFromFloatsToRef(f[6],f[7],f[8],T,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,l,this.pTemp),h[m]=this.pTemp.x,h[m+1]=this.pTemp.y,h[m+2]=this.pTemp.z},t.prototype.highLightFace=function(t,e){var i=3*t,o=this.faceVertices[i],r=this.faceVertices[i+1],n=this.faceVertices[i+2],h=this.mesh.getWorldMatrix(),c=this.vertices,p=3*o,m=3*r,f=3*n;s.TransformCoordinatesFromFloatsToRef(c[p],c[p+1],c[p+2],h,this.v1v),s.TransformCoordinatesFromFloatsToRef(c[m],c[m+1],c[m+2],h,this.v2v),s.TransformCoordinatesFromFloatsToRef(c[f],c[f+1],c[f+2],h,this.v3v);var T=this.v1v.subtract(this.v2v),l=this.v3v.subtract(this.v2v);this.faceSelector.rotation=this.getRotation(T,l),e.position.x=(this.v1v.x+this.v2v.x+this.v3v.x)/3,e.position.y=(this.v1v.y+this.v2v.y+this.v3v.y)/3,e.position.z=(this.v1v.z+this.v2v.z+this.v3v.z)/3;var d=e.getVerticesData(a.PositionKind),v=e.getWorldMatrix().clone().invert();s.TransformCoordinatesToRef(this.v1v,v,this.pTemp),d[0]=this.pTemp.x,d[1]=this.pTemp.y,d[2]=this.pTemp.z,s.TransformCoordinatesToRef(this.v2v,v,this.pTemp),d[3]=this.pTemp.x,d[4]=this.pTemp.y,d[5]=this.pTemp.z,s.TransformCoordinatesToRef(this.v3v,v,this.pTemp),d[6]=this.pTemp.x,d[7]=this.pTemp.y,d[8]=this.pTemp.z,e.setVerticesData(a.PositionKind,d,!0),this.ec.switchTo(e,!0)},t.prototype.setMaterial=function(t,e,i){t.material=new o("",i),t.material.diffuseColor=e},t.prototype.clearColors=function(t){for(var e=t.length-3,i=0;i<e;i+=4)t[i]=1,t[i+1]=1,t[i+2]=1,t[i+3]=1},t.prototype.setColor=function(t,e,i){e[t]=i.r,e[t+1]=i.g,e[t+2]=i.b,e[t+3]=0},t.prototype.onKeyUp=function(t){var e=t,i=String.fromCharCode(e.keyCode);e.keyCode,"F"===i&&(this.camera.target.x=this.faceSelector.position.x,this.camera.target.y=this.faceSelector.position.y,this.camera.target.z=this.faceSelector.position.z),"1"===i&&this.ec.enableTranslation(),"2"===i&&this.ec.enableRotation(),"3"===i&&(this.ec.enableScaling(),this.ec.isLocal()||this.ec.setLocal(!0)),"L"===i&&this.ec.setLocal(!this.ec.isLocal()),"W"===i&&(this.mesh.material.wireframe=!this.mesh.material.wireframe)},t.prototype.createTriangle=function(t,e,i){var s=new r(e/2,-e/2).addLineTo(e/2,e/2).addLineTo(-e/2,e/2).addLineTo(e/2,-e/2);return new BABYLON.PolygonMeshBuilder(t,s,i).build(!0)},t.prototype.getRotation=function(t,e){s.CrossToRef(t,e,this.pTemp);var i=s.Cross(this.pTemp,t);return s.RotationFromAxis(i,this.pTemp,t)},t}();e.MeshEditor=h}(e.component||(e.component={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));