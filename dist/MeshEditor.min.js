var org;!function(e){!function(t){!function(t){!function(t){var o=BABYLON.Color3,i=BABYLON.Vector3,s=BABYLON.Mesh,r=BABYLON.StandardMaterial,a=BABYLON.VertexBuffer,n=e.ssatguru.babylonjs.component.EditControl,c=function(){function e(e,t,c,l){var h=this;this.faceId=0,this.prevPosition=i.Zero(),this.delta=i.Zero(),this.facePicked=0,this.faceSelected=!1,this.camera=t,window.addEventListener("keyup",function(e){return h.onKeyUp(e)},!1),this.mesh=e,this.mesh.markVerticesDataAsUpdatable(a.PositionKind,!0),this.vertices=e.getVerticesData(a.PositionKind);e.getVerticesData(a.NormalKind),e.getVerticesData(a.UVKind);this.faceVertices=e.getIndices(),this.vrtColors=new Array(4*this.vertices.length/3),this.clearColors(this.vrtColors);this.faceSelector=s.CreateSphere("",10,.1,l),this.faceSelector.material=new r("impactMat",l),this.faceSelector.material.diffuseColor=o.Black(),this.faceSelector.rotationQuaternion=BABYLON.Quaternion.Zero(),this.ec=new n(this.faceSelector,t,c,.5,!1),this.ec.addActionListener(function(e){h.faceSelector.position.subtractToRef(h.prevPosition,h.delta),p.position.addInPlace(h.delta),f.position.addInPlace(h.delta),d.position.addInPlace(h.delta),h.prevPosition.set(h.faceSelector.position.x,h.faceSelector.position.y,h.faceSelector.position.z),h.updateFacePosition(h.facePicked,h.points),h.mesh.updateVerticesData(a.PositionKind,h.vertices,!1,!1)});var p=s.CreateSphere("s1",3,.1,l);this.setMaterial(p,o.Blue(),l);var f=p.clone("s2"),d=p.clone("s3");this.points=[p,f,d],l.onPointerDown=function(e,t){2==e.button&&t.hit&&(h.ec.enableTranslation(),h.faceSelected=!0,h.faceSelector.position=t.pickedPoint,h.prevPosition.set(h.faceSelector.position.x,h.faceSelector.position.y,h.faceSelector.position.z),h.clearColors(h.vrtColors),h.facePicked=t.faceId,h.highLightFace(h.facePicked,o.Gray(),h.points))}}return e.prototype.updateFacePosition=function(e,t){var o=3*e,i=this.faceVertices[o],s=this.faceVertices[o+1],r=this.faceVertices[o+2],a=this.vertices,n=3*i,c=3*s,l=3*r;a[n]=t[0].position.x,a[n+1]=t[0].position.y,a[n+2]=t[0].position.z,a[c]=t[1].position.x,a[c+1]=t[1].position.y,a[c+2]=t[1].position.z,a[l]=t[2].position.x,a[l+1]=t[2].position.y,a[l+2]=t[2].position.z},e.prototype.highLightFace=function(e,t,o){var s=3*e,r=this.faceVertices[s],n=this.faceVertices[s+1],c=this.faceVertices[s+2];console.log("face vertex index : "+r+","+n+","+c);var l=this.vertices,h=3*r,p=3*n,f=3*c,d=new i(l[h],l[h+1],l[h+2]),u=new i(l[p],l[p+1],l[p+2]),v=new i(l[f],l[f+1],l[f+2]);o[0].position=d,o[1].position=u,o[2].position=v;var C=4*r,y=4*n,S=4*c;this.setColor(C,this.vrtColors,t),this.setColor(y,this.vrtColors,t),this.setColor(S,this.vrtColors,t),this.mesh.setVerticesData(a.ColorKind,this.vrtColors,!0)},e.prototype.setMaterial=function(e,t,o){e.material=new r("",o),e.material.diffuseColor=t},e.prototype.clearColors=function(e){for(var t=e.length-3,o=0;o<t;o+=4)e[o]=1,e[o+1]=1,e[o+2]=1,e[o+3]=1},e.prototype.setColor=function(e,t,o){t[e]=o.r,t[e+1]=o.g,t[e+2]=o.b,t[e+3]=0},e.prototype.onKeyUp=function(e){var t=e,o=String.fromCharCode(t.keyCode);27===t.keyCode&&(this.faceSelected=!1,this.ec.disableTranslation()),"F"===o&&(this.camera.target=this.faceSelector.position)},e}();t.MeshEditor=c}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));