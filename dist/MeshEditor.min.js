var org;!function(e){!function(t){!function(t){!function(t){var i=BABYLON.Color3,o=BABYLON.Vector3,a=BABYLON.StandardMaterial,s=BABYLON.Path2,r=BABYLON.VertexBuffer,n=e.ssatguru.babylonjs.component.EditControl,c=function(){function e(e,t,s,c){var h=this;this.faceId=0,this.delta=o.Zero(),this.facePicked=0,this.pTemp=o.Zero(),this.camera=t,window.addEventListener("keyup",function(e){return h.onKeyUp(e)},!1),this.mesh=e,this.mesh.markVerticesDataAsUpdatable(r.PositionKind,!0),this.vertices=e.getVerticesData(r.PositionKind);e.getVerticesData(r.NormalKind),e.getVerticesData(r.UVKind);this.faceVertices=e.getIndices(),this.faceSelector=this.createTriangle("selector",1,c),this.faceSelector.material=new a("impactMat",c),this.faceSelector.material.diffuseColor=i.Black(),this.faceSelector.rotationQuaternion=BABYLON.Quaternion.Identity(),this.faceSelector.markVerticesDataAsUpdatable(r.PositionKind,!0),this.ec=new n(this.faceSelector,t,s,.5,!1),this.ec.setLocal(!0),this.ec.enableTranslation(),this.highLightFace(0,this.faceSelector),this.highLightFace(0,this.faceSelector),this.ec.addActionListener(function(e){h.updateFacePosition(h.facePicked,h.faceSelector),h.mesh.updateVerticesData(r.PositionKind,h.vertices,!1,!1)}),c.onPointerDown=function(e,t){if(2==e.button&&t.hit){if(t.pickedMesh!=h.mesh)return;h.facePicked=t.faceId,console.log("face id "+h.facePicked),h.highLightFace(h.facePicked,h.faceSelector)}}}return e.prototype.updateFacePosition=function(e,t){var i=3*e,a=this.faceVertices[i],s=this.faceVertices[i+1],n=this.faceVertices[i+2],c=this.vertices,h=3*a,p=3*s,f=3*n,l=t.getVerticesData(r.PositionKind),d=t.getWorldMatrix();o.TransformCoordinatesFromFloatsToRef(l[0],l[1],l[2],d,this.pTemp),c[h]=this.pTemp.x,c[h+1]=this.pTemp.y,c[h+2]=this.pTemp.z,o.TransformCoordinatesFromFloatsToRef(l[3],l[4],l[5],d,this.pTemp),c[p]=this.pTemp.x,c[p+1]=this.pTemp.y,c[p+2]=this.pTemp.z,o.TransformCoordinatesFromFloatsToRef(l[6],l[7],l[8],d,this.pTemp),c[f]=this.pTemp.x,c[f+1]=this.pTemp.y,c[f+2]=this.pTemp.z},e.prototype.highLightFace=function(e,t){var i=3*e,a=this.faceVertices[i],s=this.faceVertices[i+1],n=this.faceVertices[i+2];console.log("face vertex index : "+a+","+s+","+n);var c=this.vertices,h=3*a,p=3*s,f=3*n;t.position.x=(c[h]+c[p]+c[f])/3,t.position.y=(c[h+1]+c[p+1]+c[f+1])/3,t.position.z=(c[h+2]+c[p+2]+c[f+2])/3;var l=t.getVerticesData(r.PositionKind),d=t.getWorldMatrix().invert();o.TransformCoordinatesFromFloatsToRef(c[h],c[h+1],c[h+2],d,this.pTemp),l[0]=this.pTemp.x,l[1]=this.pTemp.y,l[2]=this.pTemp.z,o.TransformCoordinatesFromFloatsToRef(c[p],c[p+1],c[p+2],d,this.pTemp),l[3]=this.pTemp.x,l[4]=this.pTemp.y,l[5]=this.pTemp.z,o.TransformCoordinatesFromFloatsToRef(c[f],c[f+1],c[f+2],d,this.pTemp),l[6]=this.pTemp.x,l[7]=this.pTemp.y,l[8]=this.pTemp.z,t.setVerticesData(r.PositionKind,l,!0)},e.prototype.setMaterial=function(e,t,i){e.material=new a("",i),e.material.diffuseColor=t},e.prototype.clearColors=function(e){for(var t=e.length-3,i=0;i<t;i+=4)e[i]=1,e[i+1]=1,e[i+2]=1,e[i+3]=1},e.prototype.setColor=function(e,t,i){t[e]=i.r,t[e+1]=i.g,t[e+2]=i.b,t[e+3]=0},e.prototype.onKeyUp=function(e){var t=e,i=String.fromCharCode(t.keyCode);t.keyCode,"F"===i&&(this.camera.target.x=this.faceSelector.position.x,this.camera.target.y=this.faceSelector.position.y,this.camera.target.z=this.faceSelector.position.z),"1"===i&&this.ec.enableTranslation(),"2"===i&&this.ec.enableRotation()},e.prototype.createTriangle=function(e,t,i){var o=new s(t/2,-t/2).addLineTo(t/2,t/2).addLineTo(-t/2,t/2).addLineTo(t/2,-t/2);return new BABYLON.PolygonMeshBuilder(e,o,i).build(!0)},e}();t.MeshEditor=c}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));