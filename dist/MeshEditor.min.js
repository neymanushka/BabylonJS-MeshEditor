var org;!function(t){!function(e){!function(e){!function(e){var i=BABYLON.Color3,s=BABYLON.Vector3,o=BABYLON.Mesh,r=BABYLON.StandardMaterial,a=BABYLON.Path2,n=BABYLON.VertexBuffer,h=t.ssatguru.babylonjs.component.EditControl,p=function(){function t(t,e,i,r){var a=this;this.facePicked=0,this.mode="F",this.v1v=new s(0,0,0),this.v2v=new s(0,0,0),this.v3v=new s(0,0,0),this.pTemp=s.Zero(),this.camera=e,this.mesh=t,window.addEventListener("keyup",function(t){return a.onKeyUp(t)},!1),this.mesh.markVerticesDataAsUpdatable(n.PositionKind,!0),this.vertices=t.getVerticesData(n.PositionKind),this.faceVertices=t.getIndices(),"F"==this.mode?(this.faceSelector=this.createFaceSelector(r),this.ec=new h(this.faceSelector,e,i,.5,!0)):"E"==this.mode?(this.edgeSelector=this.createEdgeSelector(r),this.ec=new h(this.edgeSelector,e,i,.5,!0)):"P"==this.mode&&(console.log("point selectot"),this.pointSelector=new o("pointSelector",r),this.ec=new h(this.pointSelector,e,i,.5,!0)),this.ec.setLocal(!0),this.ec.enableTranslation(),this.ec.addActionListener(function(t){"F"==a.mode?a.updateFacePosition(a.facePicked,a.faceSelector):"E"==a.mode?a.updateEdgePosition(a.facePicked,a.edgeSelector):"P"==a.mode&&a.updatePointPosition(a.facePicked,a.pointSelector),a.mesh.updateVerticesData(n.PositionKind,a.vertices,!1,!1)}),r.onPointerDown=function(t,e){if(2==t.button&&e.hit){if(e.pickedMesh!=a.mesh)return;a.facePicked=e.faceId,console.log("face id "+a.facePicked),"F"==a.mode?a.highLightFace(a.facePicked,a.faceSelector):"E"==a.mode?a.highLightEdge(a.facePicked,e.pickedPoint,a.edgeSelector):"P"==a.mode&&a.highLightPoint(a.facePicked,e.pickedPoint,a.pointSelector)}}}return t.prototype.enablePoint=function(){this.mode="P"},t.prototype.enableEdge=function(){this.mode="E"},t.prototype.enableFace=function(){this.mode="F"},t.prototype.createFaceSelector_old=function(t){var e=this.createTriangle("selector",1,t);return e.material=new r("impactMat",t),e.material.diffuseColor=i.Gray(),e.visibility=.8,e.markVerticesDataAsUpdatable(n.PositionKind,!0),e.renderingGroupId=1,e},t.prototype.createFaceSelector=function(t){var e=o.CreateLines("edgeSelector",[new s(-1,0,0),new s(1,0,0),new s(0,0,1),new s(-1,0,0)],t),a=new r("edgeMat",t);return a.diffuseColor=i.Black(),a.emissiveColor=i.Black(),e.material=a,e.visibility=1,e.markVerticesDataAsUpdatable(n.PositionKind,!0),e.renderingGroupId=1,e},t.prototype.createEdgeSelector=function(t){var e=o.CreateLines("edgeSelector",[new s(-1,0,0),new s(1,0,0)],t);return e.color=i.Black(),e.isPickable=!1,e.renderingGroupId=1,e.markVerticesDataAsUpdatable(n.PositionKind,!0),e},t.prototype.highLightFace=function(t,e){console.log("highLightFace"),this.getFaceVertices(t,this.mesh,this.faceVertices);var i=this.v1v.subtract(this.v2v),o=this.v3v.subtract(this.v2v);e.rotation=this.getRotation(i,o),e.position.x=(this.v1v.x+this.v2v.x+this.v3v.x)/3,e.position.y=(this.v1v.y+this.v2v.y+this.v3v.y)/3,e.position.z=(this.v1v.z+this.v2v.z+this.v3v.z)/3;var r=e.getVerticesData(n.PositionKind);console.log(r.length);var a=e.getWorldMatrix().clone().invert();s.TransformCoordinatesToRef(this.v1v,a,this.pTemp),r[0]=this.pTemp.x,r[1]=this.pTemp.y,r[2]=this.pTemp.z,s.TransformCoordinatesToRef(this.v2v,a,this.pTemp),r[3]=this.pTemp.x,r[4]=this.pTemp.y,r[5]=this.pTemp.z,s.TransformCoordinatesToRef(this.v3v,a,this.pTemp),r[6]=this.pTemp.x,r[7]=this.pTemp.y,r[8]=this.pTemp.z,r[9]=r[0],r[10]=r[1],r[11]=r[2],e.setVerticesData(n.PositionKind,r,!0),this.ec.switchTo(e,!0)},t.prototype.updateFacePosition=function(t,e){var i=3*t,o=this.faceVertices[i],r=this.faceVertices[i+1],a=this.faceVertices[i+2],h=this.vertices,p=3*o,c=3*r,m=3*a,v=e.getVerticesData(n.PositionKind),d=e.getWorldMatrix(),l=this.mesh.getWorldMatrix().clone().invert();s.TransformCoordinatesFromFloatsToRef(v[0],v[1],v[2],d,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,l,this.pTemp),h[p]=this.pTemp.x,h[p+1]=this.pTemp.y,h[p+2]=this.pTemp.z,s.TransformCoordinatesFromFloatsToRef(v[3],v[4],v[5],d,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,l,this.pTemp),h[c]=this.pTemp.x,h[c+1]=this.pTemp.y,h[c+2]=this.pTemp.z,s.TransformCoordinatesFromFloatsToRef(v[6],v[7],v[8],d,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,l,this.pTemp),h[m]=this.pTemp.x,h[m+1]=this.pTemp.y,h[m+2]=this.pTemp.z},t.prototype.highLightEdge=function(t,e,i){console.log("highLightEdge"),this.getFaceVertices(t,this.mesh,this.faceVertices);var o,r,a,h=this.getDistance(e,this.v1v,this.v2v),p=this.getDistance(e,this.v2v,this.v3v),c=this.getDistance(e,this.v3v,this.v1v),m=Math.min(h,p,c);m==h&&(o=this.v1v,r=this.v2v,a=this.v3v,this.ep1=1,this.ep2=2),m==p&&(o=this.v2v,r=this.v3v,a=this.v1v,this.ep1=2,this.ep2=3),m==c&&(o=this.v3v,r=this.v1v,a=this.v2v,this.ep1=3,this.ep2=1);var v=o.subtract(r),d=a.subtract(r);i.rotation=this.getRotation(v,d),i.position.x=(o.x+r.x)/2,i.position.y=(o.y+r.y)/2,i.position.z=(o.z+r.z)/2;var l=i.getVerticesData(n.PositionKind),T=i.getWorldMatrix().clone().invert();s.TransformCoordinatesToRef(o,T,this.pTemp),l[0]=this.pTemp.x,l[1]=this.pTemp.y,l[2]=this.pTemp.z,s.TransformCoordinatesToRef(r,T,this.pTemp),l[3]=this.pTemp.x,l[4]=this.pTemp.y,l[5]=this.pTemp.z,i.setVerticesData(n.PositionKind,l,!0),this.ec.switchTo(i,!0)},t.prototype.updateEdgePosition=function(t,e){var i=3*t,o=this.faceVertices[i+this.ep1-1],r=this.faceVertices[i+this.ep2-1],a=this.vertices,h=3*o,p=3*r,c=e.getVerticesData(n.PositionKind),m=e.getWorldMatrix(),v=this.mesh.getWorldMatrix().clone().invert();s.TransformCoordinatesFromFloatsToRef(c[0],c[1],c[2],m,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,v,this.pTemp),a[h]=this.pTemp.x,a[h+1]=this.pTemp.y,a[h+2]=this.pTemp.z,s.TransformCoordinatesFromFloatsToRef(c[3],c[4],c[5],m,this.pTemp),s.TransformCoordinatesFromFloatsToRef(this.pTemp.x,this.pTemp.y,this.pTemp.z,v,this.pTemp),a[p]=this.pTemp.x,a[p+1]=this.pTemp.y,a[p+2]=this.pTemp.z},t.prototype.highLightPoint=function(t,e,i){this.getFaceVertices(t,this.mesh,this.faceVertices);var s,o,r,a=e.subtract(this.v1v).length(),n=e.subtract(this.v2v).length(),h=e.subtract(this.v3v).length(),p=Math.min(a,n,h);p==a&&(this.p=1,s=this.v1v,o=this.v3v,r=this.v2v),p==n&&(this.p=2,s=this.v2v,o=this.v1v,r=this.v3v),p==h&&(this.p=3,s=this.v3v,o=this.v2v,r=this.v1v);var c=o.subtract(s),m=r.subtract(s);i.rotation=this.getRotation(c,m),i.position=s,this.ec.switchTo(i,!0)},t.prototype.updatePointPosition=function(t,e){var i=3*t,o=this.faceVertices[i+this.p-1],r=this.vertices,a=3*o,n=this.mesh.getWorldMatrix().clone().invert();s.TransformCoordinatesToRef(e.position,n,this.pTemp),r[a]=this.pTemp.x,r[a+1]=this.pTemp.y,r[a+2]=this.pTemp.z},t.prototype.getFaceVertices=function(t,e,i){var o=3*t,r=i[o],a=i[o+1],n=i[o+2],h=e.getWorldMatrix(),p=this.vertices,c=3*r,m=3*a,v=3*n;s.TransformCoordinatesFromFloatsToRef(p[c],p[c+1],p[c+2],h,this.v1v),s.TransformCoordinatesFromFloatsToRef(p[m],p[m+1],p[m+2],h,this.v2v),s.TransformCoordinatesFromFloatsToRef(p[v],p[v+1],p[v+2],h,this.v3v)},t.prototype.setMaterial=function(t,e,i){t.material=new r("",i),t.material.diffuseColor=e},t.prototype.clearColors=function(t){for(var e=t.length-3,i=0;i<e;i+=4)t[i]=1,t[i+1]=1,t[i+2]=1,t[i+3]=1},t.prototype.setColor=function(t,e,i){e[t]=i.r,e[t+1]=i.g,e[t+2]=i.b,e[t+3]=0},t.prototype.onKeyUp=function(t){var e=t,i=String.fromCharCode(e.keyCode);e.keyCode,"F"===i&&(this.camera.target=this.ec.getPosition()),"1"===i&&this.ec.enableTranslation(),"2"===i&&this.ec.enableRotation(),"3"===i&&(this.ec.enableScaling(),this.ec.isLocal()||this.ec.setLocal(!0)),"L"===i&&this.ec.setLocal(!this.ec.isLocal()),"W"===i&&(this.mesh.material.wireframe=!this.mesh.material.wireframe)},t.prototype.createTriangle=function(t,e,i){var s=new a(e/2,-e/2).addLineTo(e/2,e/2).addLineTo(-e/2,e/2).addLineTo(e/2,-e/2);return new BABYLON.PolygonMeshBuilder(t,s,i).build(!0)},t.prototype.getRotation=function(t,e){s.CrossToRef(t,e,this.pTemp);var i=s.Cross(this.pTemp,t);return s.RotationFromAxis(i,this.pTemp,t)},t.prototype.getDistance=function(t,e,i){var o=t.subtract(e),r=i.subtract(e),a=Math.acos(s.Dot(o,r.normalize())/o.length());return o.length()*Math.sin(a)},t}();e.MeshEditor=p}(e.component||(e.component={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));